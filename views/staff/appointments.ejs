<!DOCTYPE html>
<html>
<head>
    <title>Your Appointments</title>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>

<header>
    <h1>Your Appointments</h1>
    <nav>
        <a href="/staff/dashboard">Dashboard</a>
        <a href="/staff/patient-search">Patient Search</a>
        <a href="/auth/logout">Logout</a>
    </nav>
</header>

<main>

    <% if (error) { %>
        <div class="error-box"><%= error %></div>
    <% } %>

    <!-- ================= TODAY ================= -->
    <section>
        <h2>Today's Appointments</h2>

        <% if (today.length === 0) { %>
            <p>No appointments today.</p>
        <% } else { %>
            <table>
                <tr>
                    <th>Time</th>
                    <th>Patient</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>

                <% today.forEach(app => { %>
                    <tr>
                        <td><%= new Date(app.appointment_date).toLocaleTimeString() %></td>
                        <td><%= app.patient_first %> <%= app.patient_last %></td>
                        <td><%= app.reason %></td>
                        <td><%= app.appointment_status %></td>
                        <td>
                            <% if (app.appointment_status === "booked") { %>
                                <form
                                    action="/staff/appointments/<%= app.id %>/cancel"
                                    method="POST"
                                    style="display:inline;"
                                    onsubmit="return confirm('Cancel this appointment?');"
                                >
                                    <button class="btn-cancel">Cancel</button>
                                </form>
                            <% } else { %>
                                —
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </table>
        <% } %>
    </section>

    <!-- ================= UPCOMING ================= -->
    <section>
        <h2>Upcoming Appointments</h2>

        <% if (upcoming.length === 0) { %>
            <p>No upcoming appointments.</p>
        <% } else { %>
            <table>
                <tr>
                    <th>Date</th>
                    <th>Patient</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>

                <% upcoming.forEach(app => { %>
                    <tr>
                        <td><%= new Date(app.appointment_date).toLocaleString() %></td>
                        <td><%= app.patient_first %> <%= app.patient_last %></td>
                        <td><%= app.reason %></td>
                        <td><%= app.appointment_status %></td>
                        <td>
                            <% if (app.appointment_status === "booked") { %>
                                <form
                                    action="/staff/appointments/<%= app.id %>/cancel"
                                    method="POST"
                                    style="display:inline;"
                                    onsubmit="return confirm('Cancel this appointment?');"
                                >
                                    <button class="btn-cancel">Cancel</button>
                                </form>
                            <% } else { %>
                                —
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </table>
        <% } %>
    </section>

    <!-- ================= PAST ================= -->
    <section>
        <h2>Past Appointments</h2>

        <% if (past.length === 0) { %>
            <p>No past appointments.</p>
        <% } else { %>
            <table>
                <tr>
                    <th>Date</th>
                    <th>Patient</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>

                <% past.forEach(app => { %>
                    <tr>
                        <td><%= new Date(app.appointment_date).toLocaleString() %></td>
                        <td><%= app.patient_first %> <%= app.patient_last %></td>
                        <td><%= app.reason %></td>
                        <td><%= app.appointment_status %></td>
                        <td>—</td>
                    </tr>
                <% }) %>
            </table>
        <% } %>
    </section>


    <!-- ================= CANCELLED ================= -->
    <section>
        <h2>Cancelled Appointments</h2>

        <% if (cancelled.length === 0) { %>
            <p>No cancelled appointments.</p>
        <% } else { %>
            <table>
                <tr>
                    <th>Date</th>
                    <th>Patient</th>
                    <th>Reason</th>
                    <th>Status</th>
                </tr>

                <% cancelled.forEach(app => { %>
                    <tr>
                        <td><%= new Date(app.appointment_date).toLocaleString() %></td>
                        <td><%= app.patient_first %> <%= app.patient_last %></td>
                        <td><%= app.reason %></td>
                        <td style="color:red;"><%= app.appointment_status %></td>
                    </tr>
                <% }) %>
            </table>
        <% } %>
    </section>

</main>

</body>
</html>
